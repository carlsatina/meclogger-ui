import{_ as L,c as d,o as c,a as t,b as R,d as b,r as U,t as l,w as x,e as u,f as B,u as E,g as z,h as F}from"./index-DALjrduZ.js";const I={name:"CarMaintenanceScheduleDetailWeb",setup(){const g=F(),a=E(),{getReminder:h,deleteReminder:n,getPreferences:_}=z(),r=u(null),i=u(!1),o=u(!1),f=u(""),y=u(!1),m=u("km"),w=e=>{if(!e)return"—";const s=new Date(e);return Number.isNaN(s.getTime())?"—":s.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})},D=e=>{if(e==null)return"—";const s=Number(e)||0,v=m.value==="mi"?s*.621371:s,V=m.value==="mi"?"mi":"km";return`${v.toLocaleString()} ${V}`},k=e=>e&&[e.make,e.model,e.year].filter(Boolean).join(" ").trim()||"Vehicle",p=e=>{if(!(e!=null&&e.dueDate))return null;const s=new Date(e.dueDate);if(Number.isNaN(s.getTime()))return null;const v=new Date;return Math.floor((s.getTime()-v.getTime())/(1e3*60*60*24))},N=e=>{if(e!=null&&e.completed)return{label:"Completed"};const s=p(e);return s===null?{label:"No due date"}:s<0?{label:"Missed"}:s===0?{label:"Due today"}:s===1?{label:"Due tomorrow"}:{label:`${s} days left`}},S=async()=>{try{const e=localStorage.getItem("token");if(!e)return;const s=await _(e);s!=null&&s.distanceUnit&&(m.value=s.distanceUnit)}catch{m.value="km"}},C=async()=>{i.value=!0,f.value="";try{const e=localStorage.getItem("token");if(!e)throw new Error("You must be logged in.");const s=await h(e,g.params.id);r.value=s}catch(e){f.value=(e==null?void 0:e.message)||"Unable to load schedule"}finally{i.value=!1}},M=()=>{var e;(e=r.value)!=null&&e.id&&a.push({path:"/web/car-maintenance/schedules/add",query:{id:r.value.id}})},T=async()=>{var e;if((e=r.value)!=null&&e.id){o.value=!0;try{const s=localStorage.getItem("token");if(!s)throw new Error("You must be logged in.");await n(s,r.value.id),y.value=!1,a.push("/web/car-maintenance")}catch(s){alert((s==null?void 0:s.message)||"Unable to delete schedule")}finally{o.value=!1}}};return B(async()=>{await S(),await C()}),{router:a,reminder:r,loading:i,deleting:o,errorMessage:f,showDelete:y,displayName:k,formatDate:w,formatMileage:D,statusFor:N,editSchedule:M,confirmDelete:T}}},P={class:"car-shell"},Y={class:"car-hero"},j={class:"car-brand"},q={class:"car-body"},W={key:0,class:"car-empty"},A={key:1,class:"car-empty"},G={key:2,class:"car-empty"},H={key:3,class:"car-panel"},J={class:"car-record-top"},K={class:"car-record-title"},O={class:"car-record-date"},Q={class:"car-pill"},X={class:"car-meta-row"},Z={class:"car-meta"},$={class:"car-meta"},ee={class:"car-detail-grid"},te={class:"car-detail-row"},ae={class:"car-detail-value"},ne={class:"car-detail-row"},se={class:"car-detail-value"},oe={class:"car-detail-actions"},le={class:"car-modal"},re={class:"car-modal-actions"},ie=["disabled"];function de(g,a,h,n,_,r){const i=U("mdicon");return c(),d("div",P,[a[11]||(a[11]=t("div",{class:"car-orb one"},null,-1)),a[12]||(a[12]=t("div",{class:"car-orb two"},null,-1)),t("header",Y,[t("div",j,[t("button",{class:"car-icon-btn",onClick:a[0]||(a[0]=o=>n.router.back())},[b(i,{name:"chevron-left",size:22})]),a[6]||(a[6]=t("div",null,[t("p",{class:"eyebrow"},"Car Maintenance"),t("h2",{class:"headline"},"Schedule Detail")],-1))])]),t("main",q,[n.loading?(c(),d("div",W,"Loading...")):n.errorMessage?(c(),d("div",A,l(n.errorMessage),1)):n.reminder?(c(),d("div",H,[t("div",J,[t("div",null,[t("p",K,l(n.reminder.maintenanceType||"Schedule"),1),t("p",O,l(n.formatDate(n.reminder.dueDate)),1)]),t("span",Q,l(n.statusFor(n.reminder).label),1)]),t("div",X,[t("div",Z,[b(i,{name:"counter",size:18}),t("span",null,l(n.formatMileage(n.reminder.dueMileage)),1)]),t("div",$,[b(i,{name:"timer-sand",size:18}),t("span",null,l(n.statusFor(n.reminder).label),1)])]),t("div",ee,[t("div",te,[a[7]||(a[7]=t("span",{class:"car-detail-label"},"Vehicle",-1)),t("span",ae,l(n.displayName(n.reminder.vehicle)),1)]),t("div",ne,[a[8]||(a[8]=t("span",{class:"car-detail-label"},"Notes",-1)),t("span",se,l(n.reminder.description||"—"),1)])]),t("div",oe,[t("button",{class:"car-btn ghost full",onClick:a[1]||(a[1]=(...o)=>n.editSchedule&&n.editSchedule(...o))},"Edit"),t("button",{class:"car-btn danger full",onClick:a[2]||(a[2]=o=>n.showDelete=!0)},"Delete")])])):(c(),d("div",G,"Schedule not found."))]),n.showDelete?(c(),d("div",{key:0,class:"car-modal-backdrop",onClick:a[5]||(a[5]=x(o=>n.showDelete=!1,["self"]))},[t("div",le,[a[9]||(a[9]=t("p",{class:"car-modal-title"},"Delete schedule?",-1)),a[10]||(a[10]=t("p",{class:"car-modal-text"},"This cannot be undone.",-1)),t("div",re,[t("button",{class:"cancel",onClick:a[3]||(a[3]=o=>n.showDelete=!1)},"Cancel"),t("button",{class:"confirm",disabled:n.deleting,onClick:a[4]||(a[4]=(...o)=>n.confirmDelete&&n.confirmDelete(...o))},l(n.deleting?"Deleting...":"Delete"),9,ie)])])])):R("",!0)])}const ue=L(I,[["render",de]]);export{ue as default};
